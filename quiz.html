<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <script>
        let correctAnswer;  // 正解の答えを格納する変数
        let score = 0;      // スコア

        // JSONファイルから問題データを非同期で読み込む
        async function loadQuestions() {
            const response = await fetch('questions.json');
            const questionData = await response.json();
            
            // ランダムに問題を選択
            const randomIndex = Math.floor(Math.random() * questionData.length);
            const currentQuestion = questionData[randomIndex];
            correctAnswer = currentQuestion[2];  // 正解の答えを保存

            // ランダムに3つの不正解の選択肢を取得
            const incorrectOptions = [];
            while (incorrectOptions.length < 3) {
                const randomOption = questionData[Math.floor(Math.random() * questionData.length)][2];
                if (randomOption !== correctAnswer && !incorrectOptions.includes(randomOption)) {
                    incorrectOptions.push(randomOption);
                }
            }

            // 選択肢に正解と不正解の要素を組み合わせてシャッフル
            let options = [correctAnswer, ...incorrectOptions];
            options = shuffle(options);

            // HTMLを生成して表示
            document.getElementById("question").innerHTML = "問題: " + currentQuestion[1];

            // 選択肢ボタンを生成
            const optionsContainer = document.getElementById("options");
            optionsContainer.innerHTML = "";  // 選択肢をクリア

            for (let i = 0; i < options.length; i++) {
                const optionButton = document.createElement("button");
                optionButton.innerHTML = options[i];
                optionButton.onclick = function() {
                    checkAnswer(options[i]);
                };
                optionsContainer.appendChild(optionButton);
            }

            // 結果メッセージをクリア
            document.getElementById("result").innerHTML = "";
        }

        function shuffle(array) {
            let currentIndex = array.length, temporaryValue, randomIndex;
            while (0 !== currentIndex) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            return array;
        }

        function checkAnswer(selectedAnswer) {
            const resultElement = document.getElementById("result");
            const answerButtons = document.querySelectorAll("button");  // すべてのボタンを取得

            // 正解判定
            if (selectedAnswer === correctAnswer) {
                resultElement.innerHTML = "正解！";
                score++;  // スコアを増やす

                // 正解した後はボタンを無効化
                answerButtons.forEach(button => {
                    button.onclick = null;
                });
            } else {
                resultElement.innerHTML = "不正解";
            }

            // スコアを表示
            document.getElementById("score").innerHTML = "スコア: " + score;

            // スコアをローカルストレージに保存
            localStorage.setItem("quizScore", score.toString());
        }

        // ページ読み込み時に最初の問題を読み込む
        window.onload = function() {
            // スコアをローカルストレージから取得
            const savedScore = localStorage.getItem("quizScore");
            if (savedScore !== null) {
                score = parseInt(savedScore, 10);
                document.getElementById("score").innerHTML = "スコア: " + score;
            }

            loadQuestions();
        };
    </script>
</head>
<body>
    <h1 id="question"></h1>

    <div id="options"></div>

    <p id="result"></p>

    <p id="score"></p>

    <!-- もう一問ボタン -->
    <button onclick="loadQuestions()">もう一問</button>
</body>
</html>
